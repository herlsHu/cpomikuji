<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°·è¯­æ—¥ç­¾ - å¨ƒåŒ…è½»é™ªä¼´OC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .upload-area {
            padding: 40px 30px;
            text-align: center;
        }

        .upload-box {
            border: 2px dashed #ddd;
            border-radius: 15px;
            padding: 40px 20px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-box:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .upload-box.dragover {
            border-color: #ff6b6b;
            background: #fff5f5;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ccc;
        }

        .upload-text {
            color: #666;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
            box-shadow: none;
        }

        .preview {
            margin-top: 20px;
        }

        .preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            display: none;
            padding: 30px;
        }

        .result.show {
            display: block;
        }

        .result-image {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .result-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .result-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-size: 14px;
        }

        .info-value {
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }

        .lucky-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
            vertical-align: middle;
            border: 2px solid #ddd;
        }

        .error {
            background: #ffe6e6;
            color: #d63031;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .upload-area {
                padding: 30px 20px;
            }
            
            .upload-box {
                padding: 30px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>è°·è¯­æ—¥ç­¾</h1>
            <p>å¨ƒåŒ…è½»é™ªä¼´OC</p>
        </div>

        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-area" id="uploadArea">
            <div class="upload-box" id="uploadBox">
                <div class="upload-icon">ğŸ“·</div>
                <div class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æˆ–æ‹–æ‹½åˆ°æ­¤å¤„</div>
                <input type="file" id="fileInput" class="file-input" accept="image/*">
                <button class="btn" onclick="document.getElementById('fileInput').click()">
                    é€‰æ‹©å›¾ç‰‡
                </button>
            </div>
            
            <div class="preview" id="preview"></div>
            
            <button class="btn" id="generateBtn" onclick="generateOmikuji()" style="display: none;">
                ç”Ÿæˆæ—¥ç­¾
            </button>
            
            <button class="btn btn-secondary" id="resetBtn" onclick="resetUpload()" style="display: none;">
                é‡æ–°é€‰æ‹©
            </button>
        </div>

        <!-- åŠ è½½ä¸­ -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <h3>æ­£åœ¨ç”Ÿæˆæ—¥ç­¾...</h3>
            <p>è¯·ç¨å€™ï¼Œæ­£åœ¨å¤„ç†æ‚¨çš„å›¾ç‰‡</p>
        </div>

        <!-- ç»“æœå±•ç¤º -->
        <div class="result" id="result">
            <img id="resultImage" class="result-image" alt="ç”Ÿæˆçš„æ—¥ç­¾">
            
            <div class="result-info">
                <h3>æ—¥ç­¾ä¿¡æ¯</h3>
                <div class="info-row">
                    <span class="info-label">å¹¸è¿è‰²</span>
                    <span class="info-value" id="luckyColor">
                        <span id="luckyColorText"></span>
                        <span class="lucky-color" id="luckyColorDot"></span>
                    </span>
                </div>
                <div class="info-row">
                    <span class="info-label">å¹¸è¿ç‰©</span>
                    <span class="info-value" id="luckyItem"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">å¹¸è¿åœ°</span>
                    <span class="info-value" id="luckyPlace"></span>
                </div>
            </div>
            
            <button class="btn" onclick="downloadImage()">
                ä¿å­˜å›¾ç‰‡
            </button>
            
            <button class="btn btn-secondary" onclick="resetUpload()">
                é‡æ–°ç”Ÿæˆ
            </button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let selectedFile = null;
        let generatedImage = null;
        let omikujiResult = null;

        // é¢œè‰²æ˜ å°„
        const colorMap = {
            "ç™½": "#FFFFFF",
            "é»‘": "#000000", 
            "çº¢": "#FF0000",
            "æ©™": "#FFA500",
            "é»„": "#FFFF00",
            "ç»¿": "#00FF00",
            "é’": "#00FFFF",
            "è“": "#0000FF",
            "ç´«": "#800080",
            "ç²‰": "#FFC0CB"
        };

        // è¯åº“æ•°æ®
        const wordBank = {
            "grade": ["å¤§å‰"],
            "yi": [
                "æ—©æ’é˜Ÿ","è½»è£…ä¸Š","äºŒå·¡é€›","è¡¥æ°´ç«™","æ‰“å¡ç‚¹","åˆç…§ç¤¼",
                "ç©¿èˆ’é‹","å¸¦å……ç”µ","è´´é˜²ç£¨","é˜²æ™’ä¼","å¤‡é›¨å…·","å°é›¶é’±",
                "è´´åç‰Œ","å­˜è¡Œæ","å…ˆå¤–åœˆ","çœ‹æŒ‡å¼•","æ’é˜Ÿè·","é¿å°–å³°",
                "å…ˆåƒé¥­","å–„è®©è·¯","ä¸»åŠ¨é—®","æ¸©å£°è¯­","å¸®æ‹ç…§","æ”¶ç¥¨æ®",
                "æ¢è½»åŒ…","æŠ¤é“å…·","æ‹‰æ‹‰é“¾","å…ˆè¯•ç¯","è®°æ‘Šå·","å¤‡æ¹¿å·¾",
                "æ¢å£ç½©","å›æ”¶è¢‹","é˜²èµ°å¤±","çº¦é›†åˆ","è½»å–ç‰©","å…ˆè§‚æ™¯",
                "éšæ‰‹é€’","ç¤¼è²Œé€€","å¤šå¾®ç¬‘","é€‚æ—¶ä¼‘",
                "çœ‹åœºåˆŠ","æŒ‰åŠ¨çº¿","æ ‡è¿”å›¾","æ‰©åˆ—ç¤¼","æŠ¤å‡å‘","æ”¶å°ç« ",
                "é¿åå…‰","å…³é—ªå…‰","ç•™ç©ºé“","è®©åæ’"
            ],
            "ji": [
                "ä¹…ä¹…ç«™","å¿˜å……ç”µ","ç¡¬æŠ¢ä½","å¤§åŒ…è£¹","ç©ºè…¹é€›",
                "æ’é˜ŸæŠ¢","å¤§å£°åµ","ä¹±æ‹æ‘„","æœªåŒæ„","æŒ¤å‹äºº",
                "æ‰åƒåœ¾","æ’é“å…·","è¸©è£™æ‘†","è¿½ç€æ‹","ä¹…ä¸æ°´",
                "è¿‡åº¦æ™’","ç©¿æ–°é‹","æ‹–åœ°è£™","ç´§è·Ÿæ‹","å µé€šé“",
                "å åº§ä¹…","é—ªç¯çŒ›","æ‹‰ä»–äºº","ä¹±è´´ç­¾","ä¸¢ç¥¨è¯",
                "æ”¾éšåœ°","å–å¤ªå°‘","è´Ÿé‡å¤š","æ¨æ¡äºº","ä¹±ç¿»åŒ…",
                "æœªæ’é˜Ÿ","è¶ŠæŠ¤æ ","é†‰é…’é€›","é€¼åˆç…§","ç¡¬å€Ÿç‰©",
                "ä¹±æ‰©åˆ—","å¼€é—ªå…‰","æŒ¡é€šé“","è´´äººæ‹","è¸©é“å…·",
                "ä¹±ç›–ç« ","æŒ¡æ‘Šä½","å æœºä½"
            ],
            "lucky_items": ["æ‰“å¡æ£’","è¢‹å­"],
            "omikuji": [
                "å¿µå¿µä¸å¿˜ï¼Œå¿…æœ‰å›å“",
                "æ—©åˆ°ä¸æ€¥ï¼Œå¥½ä½è‡ªç•™",
                "ç¯ç‰Œä½œæœˆï¼Œå‡ºç‰‡æ›´ç¨³",
                "äºŒå·¡æœ‰ç¼˜ï¼Œæ¼ç½‘å…¥è¢‹",
                "åœºåˆŠåœ¨æ‰‹ï¼Œæ–¹å‘è‡ªæ˜",
                "ç¤¼è²Œå…ˆè¡Œï¼Œç¼˜åˆ†é è¿‘",
                "å…ˆé—®åæ‹ï¼Œå‡ºç‰‡è‡ªæ¥",
                "æ‰©åˆ—é¡ºåˆ©ï¼Œæœ‹å‹å¸¸ä¼´",
                "æ­£ç‰‡æœ‰æœŸï¼Œè¿”å›¾å¦‚çº¦",
                "è°·å­åˆ°æ‰‹ï¼Œå¿ƒæ»¡æ„è¶³",
                "å§å”§å®å½“ï¼Œæ¬§æ°”æŠ¤ä½“",
                "ç—›åŒ…é—ªäº®ï¼Œäººæµ·å‘å…‰",
                "é”™å³°è€Œè¡Œï¼Œè„šæ­¥è½»å¿«",
                "æ’é˜Ÿæœ‰åºï¼Œæ¬§æ°”é è¿‘",
                "è½»è£…ä¸Šé˜µï¼Œé£ç”Ÿæ°´èµ·",
                "é›†ç« é›†å‹ï¼Œå¿«ä¹åŠ å€",
                "è¿”åœºå°èšï¼Œå¥½è¿åŠ å€",
                "å¤–åœºå¾®é£ï¼Œç…§ç‰‡ç”ŸèŠ±",
                "æ¸©å£°ç›¸å¾…ï¼Œå¥½äº‹ä¸Šé—¨",
                "è¿·è·¯ä¸æ…Œï¼ŒåŸåœ°ç­‰å‹",
                "é¥®æ°´åŠæ—¶ï¼Œä½“åŠ›å¸¸é’",
                "è¿œå…‰ä½œä¼´ï¼Œå½±åƒç”Ÿè¾‰",
                "æŒ‡å—åœ¨æ‰‹ï¼ŒåŠ¨çº¿æ˜æ™°",
                "åˆç…§å¾®ç¬‘ï¼Œè®°å¾—è‡´è°¢",
                "æŠ¤å¥½å‡å‘ï¼Œç»†èŠ‚åœ¨çº¿",
                "æŒ‚ä»¶ç¨³å›ºï¼Œç—›åŒ…å®‰å¿ƒ",
                "æ”¶çº³æœ‰æœ¯ï¼Œæˆ˜åˆ©æ»¡è¢‹",
                "ä»Šæ—¥é¡ºå¿ƒï¼Œä¸‡äº‹èƒœæ„",
                "äº‘å¼€è§ä½ ï¼Œç¦æ·»ä¸€å±‚",
                "å¿ƒæœ‰çƒ­çˆ±ï¼Œå®‡å®™å›å“",
                "ç¯ç«å¯äº²ï¼Œç¬‘è„¸å¸¸æ–°"
            ],
            "warm_tips": [
                "é”™å³°äºŒå·¡æ›´è½»æ¾",
                "ç¯ç‰Œè¡¥å…‰æ›´é€šé€",
                "æ’é˜Ÿç•™é—´è·å°±å¥½",
                "åˆç…§æœ‰ç¤¼æ›´å¥½çœ‹",
                "ç—›åŒ…æŒ‚ç‰¢æ›´å®‰å¿ƒ",
                "å§å”§å¥—å£³ä¸åˆ®èŠ±",
                "å…ˆåƒå†é€›æ›´è€ä¹…",
                "ç¥¨è¯æ”¶å¥½æ›´çœå¿ƒ",
                "é›†ç« æ…¢æ…¢ç›–ä¸ç€æ€¥",
                "æ‰©åˆ—è‡ªæˆ‘ä»‹ç»å…ˆ",
                "å–œæ¬¢å°±è¡¨è¾¾è¯•è¯•",
                "å–æ°´ä¼‘æ¯æ›´æœ‰åŠ²",
                "è¿œå…‰ä¾§èº«æ›´é€šé€",
                "æŒ‡å—åœ¨æ‰‹æ›´è¸å®"
            ]
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const uploadBox = document.getElementById('uploadBox');
            
            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ‹½äº‹ä»¶
            uploadBox.addEventListener('dragover', handleDragOver);
            uploadBox.addEventListener('dragleave', handleDragLeave);
            uploadBox.addEventListener('drop', handleDrop);
        });

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                selectedFile = file;
                showPreview(file);
                showGenerateButton();
            }
        }

        // å¤„ç†æ‹–æ‹½
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    selectedFile = file;
                    showPreview(file);
                    showGenerateButton();
                }
            }
        }

        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview(file) {
            const preview = document.getElementById('preview');
            const reader = new FileReader();
            
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" alt="é¢„è§ˆå›¾ç‰‡">`;
            };
            
            reader.readAsDataURL(file);
        }

        // æ˜¾ç¤ºç”ŸæˆæŒ‰é’®
        function showGenerateButton() {
            document.getElementById('generateBtn').style.display = 'block';
            document.getElementById('resetBtn').style.display = 'block';
        }

        // ç”Ÿæˆå åœç»“æœ
        function generateOmikuji() {
            if (!selectedFile) return;
            
            showLoading();
            
            // æ¨¡æ‹Ÿé¢œè‰²è¯†åˆ«
            setTimeout(() => {
                const luckyColor = getRandomColor();
                omikujiResult = generateOmikujiResult(luckyColor);
                generateImage();
            }, 2000);
        }

        // æ˜¾ç¤ºåŠ è½½ä¸­
        function showLoading() {
            document.getElementById('uploadArea').classList.add('hidden');
            document.getElementById('loading').classList.add('show');
        }

        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = ["ç™½","é»‘","çº¢","æ©™","é»„","ç»¿","é’","è“","ç´«","ç²‰"];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // ç”Ÿæˆå åœç»“æœ
        function generateOmikujiResult(luckyColor) {
            const randomChoice = (arr) => arr[Math.floor(Math.random() * arr.length)];
            const randomChoices = (arr, count) => {
                const shuffled = [...arr].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            };
            
            return {
                grade: wordBank.grade[0],
                lucky_color: luckyColor,
                yi: randomChoices(wordBank.yi, 3),
                ji: randomChoices(wordBank.ji, 3),
                lucky_item: randomChoice(wordBank.lucky_items),
                lucky_place: "CPä¼šåœºÂ·è°·è¯­æ‘Šä½",
                omikuji_text: randomChoice(wordBank.omikuji),
                warm_tip: randomChoice(wordBank.warm_tips)
            };
        }

        // ç”Ÿæˆå›¾ç‰‡
        function generateImage() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 750;
            canvas.height = 1334;
            
            // ç»˜åˆ¶èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, 750, 1334);
            gradient.addColorStop(0, '#ff9a9e');
            gradient.addColorStop(0.5, '#fecfef');
            gradient.addColorStop(1, '#fecfef');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 750, 1334);
            
            // ç»˜åˆ¶é¡¶éƒ¨è£…é¥°
            const headerGradient = ctx.createLinearGradient(0, 0, 750, 0);
            headerGradient.addColorStop(0, '#ff6b6b');
            headerGradient.addColorStop(1, '#ff8e8e');
            ctx.fillStyle = headerGradient;
            ctx.fillRect(0, 0, 750, 80);
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = 'white';
            ctx.font = 'bold 28px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('è°·è¯­æ—¥ç­¾', 375, 50);
            
            // ç»˜åˆ¶ä¸»è¦å†…å®¹åŒºåŸŸ
            ctx.fillStyle = 'white';
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.fillRect(50, 100, 650, 750);
            ctx.strokeRect(50, 100, 650, 750);
            
            // ç»˜åˆ¶IDç¼–å·
            ctx.fillStyle = '#666';
            ctx.font = '16px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`ID ç¼–å·: ${Date.now().toString().slice(-12)}`, 70, 130);
            
            // ç»˜åˆ¶å®œå¿Œæ ‡é¢˜
            const headerY = 180;
            ctx.font = 'bold 22px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#4ECDC4';
            ctx.fillText('å®œ', 200, headerY);
            ctx.fillStyle = '#FF6B6B';
            ctx.fillText('å¿Œ', 500, headerY);
            
            // ç»˜åˆ¶å®œå¿Œå†…å®¹
            ctx.font = '18px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#333';
            ctx.fillText(omikujiResult.yi.join(' '), 70, headerY + 30);
            ctx.fillText(omikujiResult.ji.join(' '), 370, headerY + 30);
            
            // ç»˜åˆ¶æé†’æ–‡å­—
            ctx.font = '16px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.fillText(`[OCå]æé†’æ‚¨: ${omikujiResult.warm_tip}`, 70, headerY + 80);
            
            // ç»˜åˆ¶å¹¸è¿ä¿¡æ¯
            const luckyY = headerY + 120;
            ctx.font = '16px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.fillText(`å¹¸è¿è‰² ${omikujiResult.lucky_color}`, 70, luckyY);
            ctx.fillText(`å¹¸è¿ç‰© ${omikujiResult.lucky_item}`, 70, luckyY + 25);
            ctx.fillText(`å¹¸è¿åœ° ${omikujiResult.lucky_place}`, 70, luckyY + 50);
            
            // ç»˜åˆ¶å³ä¾§ç«–æ’æ–‡å­—
            ctx.font = 'bold 18px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#333';
            
            const verticalText = 'å²å²ä»Šæœ å¥½è¿å¸¸ä¼´';
            const charHeight = 25;
            const startX = 620;
            const startY = 500;
            
            for (let i = 0; i < verticalText.length; i++) {
                const char = verticalText[i];
                if (char !== ' ') {
                    ctx.save();
                    ctx.translate(startX, startY + i * charHeight);
                    ctx.rotate(-Math.PI / 2);
                    ctx.fillText(char, 0, 0);
                    ctx.restore();
                }
            }
            
            // ç»˜åˆ¶åº•éƒ¨ä¿¡æ¯
            const bottomY = 1000;
            ctx.font = '14px PingFang SC, Microsoft YaHei, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`å¹¸è¿è‰² ${omikujiResult.lucky_color}`, 70, bottomY);
            ctx.fillText(`å¹¸è¿ç‰© ${omikujiResult.lucky_item}`, 250, bottomY);
            ctx.fillText(`å¹¸è¿åœ° ${omikujiResult.lucky_place}`, 430, bottomY);
            
            // è½¬æ¢ä¸ºå›¾ç‰‡
            generatedImage = canvas.toDataURL('image/png', 1.0);
            showResult();
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            document.getElementById('loading').classList.remove('show');
            document.getElementById('result').classList.add('show');
            
            // æ˜¾ç¤ºç»“æœå›¾ç‰‡
            document.getElementById('resultImage').src = generatedImage;
            
            // æ˜¾ç¤ºç»“æœä¿¡æ¯
            document.getElementById('luckyColorText').textContent = omikujiResult.lucky_color;
            document.getElementById('luckyColorDot').style.backgroundColor = colorMap[omikujiResult.lucky_color];
            document.getElementById('luckyItem').textContent = omikujiResult.lucky_item;
            document.getElementById('luckyPlace').textContent = omikujiResult.lucky_place;
        }

        // ä¸‹è½½å›¾ç‰‡
        function downloadImage() {
            if (generatedImage) {
                const link = document.createElement('a');
                link.download = `è°·è¯­æ—¥ç­¾-${omikujiResult.lucky_color}.png`;
                link.href = generatedImage;
                link.click();
            }
        }

        // é‡ç½®ä¸Šä¼ 
        function resetUpload() {
            selectedFile = null;
            generatedImage = null;
            omikujiResult = null;
            
            document.getElementById('fileInput').value = '';
            document.getElementById('preview').innerHTML = '';
            document.getElementById('generateBtn').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'none';
            document.getElementById('uploadArea').classList.remove('hidden');
            document.getElementById('loading').classList.remove('show');
            document.getElementById('result').classList.remove('show');
        }
    </script>
</body>
</html>
